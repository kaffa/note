<section id="nikola-tips">
<h1>Nikola Tips</h1>
<section id="nikola-serve">
<h2>1. Nikola serve 自动刷新的命令行怎么写？</h2>
<div class="code"><pre class="code shell"><a id="rest_code_24b22310d4324e218ad080e21b556417-1" name="rest_code_24b22310d4324e218ad080e21b556417-1" href="#rest_code_24b22310d4324e218ad080e21b556417-1"></a>nikola<span class="w"> </span>auto
</pre></div>
<p>即使 <strong>conf.py</strong> 中已绑定非127.0.0.1的地址，上面的命令也只会在127.0.0.1启动调试。</p>
<p>没有去看源代码，可能这样实现从安全角度存在一定的合理性。</p>
<p>如果需要任意主机都能获得访问，可使用 -a 参数指定地址0.0.0.0</p>
<div class="code"><pre class="code shell"><a id="rest_code_0b1ae375c4584d3bb6542ccfe32f9aad-1" name="rest_code_0b1ae375c4584d3bb6542ccfe32f9aad-1" href="#rest_code_0b1ae375c4584d3bb6542ccfe32f9aad-1"></a>nikola<span class="w"> </span>auto<span class="w"> </span>-a0.0.0.0
</pre></div>
</section>
<section id="nikola-theme-css">
<h2>2. Nikola Theme 如何定制 css</h2>
<p>如果在模板中有代码</p>
<div class="code"><pre class="code html+mako"><a id="rest_code_12875c8372dd4eff968feb506c28a3aa-1" name="rest_code_12875c8372dd4eff968feb506c28a3aa-1" href="#rest_code_12875c8372dd4eff968feb506c28a3aa-1"></a><span class="cp">%</span><span class="k">if</span> <span class="n">has_custom_css</span><span class="p">:</span>
<a id="rest_code_12875c8372dd4eff968feb506c28a3aa-2" name="rest_code_12875c8372dd4eff968feb506c28a3aa-2" href="#rest_code_12875c8372dd4eff968feb506c28a3aa-2"></a>  <span class="p">&lt;</span><span class="nt">link</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/assets/css/custom.css&quot;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/css&quot;</span><span class="p">&gt;</span>
<a id="rest_code_12875c8372dd4eff968feb506c28a3aa-3" name="rest_code_12875c8372dd4eff968feb506c28a3aa-3" href="#rest_code_12875c8372dd4eff968feb506c28a3aa-3"></a><span class="cp">%</span><span class="k">endif</span>
</pre></div>
<p>因此，增加 /assets/css/custom.css 文件即可。</p>
</section>
<section id="nikola-github">
<h2>3. Nikola 如何推送到 GitHub</h2>
<p>先设置好 git 推送</p>
<div class="code"><pre class="code sh"><a id="rest_code_7a1f41fe322d4b46ab0005c575a46728-1" name="rest_code_7a1f41fe322d4b46ab0005c575a46728-1" href="#rest_code_7a1f41fe322d4b46ab0005c575a46728-1"></a>git<span class="w"> </span>config<span class="w"> </span>--global<span class="w"> </span>--add<span class="w"> </span>safe.directory<span class="w"> </span>/usr/home/kaffa/web/note.tt4e.com
<a id="rest_code_7a1f41fe322d4b46ab0005c575a46728-2" name="rest_code_7a1f41fe322d4b46ab0005c575a46728-2" href="#rest_code_7a1f41fe322d4b46ab0005c575a46728-2"></a>git<span class="w"> </span>config<span class="w"> </span>--global<span class="w"> </span>user.email<span class="w"> </span><span class="s2">&quot;kaffacoffee@outlook.com&quot;</span>
<a id="rest_code_7a1f41fe322d4b46ab0005c575a46728-3" name="rest_code_7a1f41fe322d4b46ab0005c575a46728-3" href="#rest_code_7a1f41fe322d4b46ab0005c575a46728-3"></a>git<span class="w"> </span>config<span class="w"> </span>--global<span class="w"> </span>user.name<span class="w"> </span><span class="s2">&quot;Kaffa&quot;</span>
</pre></div>
<p>将以下内容保存为 aio.sh 脚本</p>
<div class="code"><pre class="code sh"><a id="rest_code_7d7de2a51a3d41fc8f664266b02f04ee-1" name="rest_code_7d7de2a51a3d41fc8f664266b02f04ee-1" href="#rest_code_7d7de2a51a3d41fc8f664266b02f04ee-1"></a><span class="ch">#!/bin/bash</span>
<a id="rest_code_7d7de2a51a3d41fc8f664266b02f04ee-2" name="rest_code_7d7de2a51a3d41fc8f664266b02f04ee-2" href="#rest_code_7d7de2a51a3d41fc8f664266b02f04ee-2"></a><span class="c1">#</span>
<a id="rest_code_7d7de2a51a3d41fc8f664266b02f04ee-3" name="rest_code_7d7de2a51a3d41fc8f664266b02f04ee-3" href="#rest_code_7d7de2a51a3d41fc8f664266b02f04ee-3"></a><span class="c1"># nikola output push to github</span>
<a id="rest_code_7d7de2a51a3d41fc8f664266b02f04ee-4" name="rest_code_7d7de2a51a3d41fc8f664266b02f04ee-4" href="#rest_code_7d7de2a51a3d41fc8f664266b02f04ee-4"></a><span class="nb">cd</span><span class="w"> </span>~/web/note.tt4e.com/
<a id="rest_code_7d7de2a51a3d41fc8f664266b02f04ee-5" name="rest_code_7d7de2a51a3d41fc8f664266b02f04ee-5" href="#rest_code_7d7de2a51a3d41fc8f664266b02f04ee-5"></a>nikola<span class="w"> </span>build
<a id="rest_code_7d7de2a51a3d41fc8f664266b02f04ee-6" name="rest_code_7d7de2a51a3d41fc8f664266b02f04ee-6" href="#rest_code_7d7de2a51a3d41fc8f664266b02f04ee-6"></a>git<span class="w"> </span>add<span class="w"> </span>.
<a id="rest_code_7d7de2a51a3d41fc8f664266b02f04ee-7" name="rest_code_7d7de2a51a3d41fc8f664266b02f04ee-7" href="#rest_code_7d7de2a51a3d41fc8f664266b02f04ee-7"></a>git<span class="w"> </span>commit<span class="w"> </span>-am<span class="w"> </span><span class="s1">&#39;Kaffa&#39;</span>
<a id="rest_code_7d7de2a51a3d41fc8f664266b02f04ee-8" name="rest_code_7d7de2a51a3d41fc8f664266b02f04ee-8" href="#rest_code_7d7de2a51a3d41fc8f664266b02f04ee-8"></a>git<span class="w"> </span>push
</pre></div>
<p>先 su 到 root 用户，然后运行以下命令，再 su 会当前用户</p>
<div class="code"><pre class="code sh"><a id="rest_code_dc4e7fa2cd284874b88fcd28d125e3a5-1" name="rest_code_dc4e7fa2cd284874b88fcd28d125e3a5-1" href="#rest_code_dc4e7fa2cd284874b88fcd28d125e3a5-1"></a>chown<span class="w"> </span>-R<span class="w"> </span>kaffa:wheel<span class="w"> </span>.git
<a id="rest_code_dc4e7fa2cd284874b88fcd28d125e3a5-2" name="rest_code_dc4e7fa2cd284874b88fcd28d125e3a5-2" href="#rest_code_dc4e7fa2cd284874b88fcd28d125e3a5-2"></a>chmod<span class="w"> </span>-R<span class="w"> </span><span class="m">777</span><span class="w"> </span>./aio.sh
</pre></div>
<p>如果遇到错误提示 Unable to create ** /.git/index.lock: Permission denied，则需要</p>
<div class="code"><pre class="code sh"><a id="rest_code_4eb0561efbc64cfc8f44f2f13d2219b1-1" name="rest_code_4eb0561efbc64cfc8f44f2f13d2219b1-1" href="#rest_code_4eb0561efbc64cfc8f44f2f13d2219b1-1"></a>chown<span class="w"> </span>-R<span class="w"> </span>kaffa:wheel<span class="w"> </span>.git
</pre></div>
<p>其中 用户名和所属组，可以用 groups 命令查看。</p>
<p>完成书上步骤后，则每次可以运行 aio.sh 来推送 GitHub，GitHub 收到推送后，会使用 GitHub Action 来处理发布。</p>
<p>使用以上方法是有效的，但却说明没有认真读 nikola 文档。</p>
<section id="nikola-github-1">
<h3>Nikola 官方支持推送到 GitHub</h3>
<p><a class="reference external" href="https://getnikola.com/handbook.html#toc-entry-60">官方文档</a></p>
<p>解释一下：</p>
<ol class="arabic simple">
<li><p>GITHUB_DEPLOY_BRANCH：发布分支，是 Nikola 产生的 HTML 文件，建议命名为 src。</p></li>
<li><p>GITHUB_SOURCE_BRANCH：源码分支，建议在 GitHub 上设置为默认分支，建议命名为 main，而不是 master[#fn1]_。</p></li>
<li><p>GITHUB_REMOTE_NAME：远程仓库名；</p></li>
<li><p>GITHUB_COMMIT_SOURCE：True，发布时会自动提交 src 分支。</p></li>
</ol>
<p>补充：</p>
<p>采用这种方法时，Github Pages 的 Build and deployment 一节，source 下拉框中，要选择 Deploy from a branch，而不是 GitHub Actions。</p>
<aside class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<span class="docutils literal">&lt;string&gt;</span>, line 99)</p>
<p>Content block expected for the &quot;code-block&quot; directive; none found.</p>
<pre class="literal-block">.. code-block ::

</pre>
</aside>
</section>
</section>
</section>
<section id="section-1">
<h1>脚注</h1>
<p>[#fn1] master：类似 master，slave 这样带有种族歧视色彩的词，在编程世界中将不再继续使用，现有使用也逐步 <a class="reference external" href="https://github.com/github/renaming">重命名</a>。</p>
</section>
